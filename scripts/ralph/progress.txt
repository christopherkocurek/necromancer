# Ralph Progress Log - Skill Tree Rework
# Created: 2026-01-09
# Project: The Necromancer - Skill Tree Rework

## Design Principles (from PRD)

1. POWER SCALE: Third Age cap - grounded heroism, not mythic. Aragorn-tier is the ceiling.
2. STEALTH UNIVERSAL: Every viable build invests ~5 points in Stealth. Infiltration is core gameplay.
3. EMERGENT ARCHETYPES: No forced classes. Builds emerge from skill synergies and item finds.
4. TOLKIEN PRECEDENT: Every ability should answer: Who in Third Age Middle-earth does this?
5. INTERESTING CHOICES: Abilities should create decision points, not just stat bumps.

## Audit Questions (apply to every ability)

1. TOLKIEN PRECEDENT: Who does this in Third Age? (cite character/event)
2. POWER SCALE: Is it grounded? Third Age ceiling, not First Age mythic.
3. STEALTH HOOK: Does it support infiltration gameplay? If not, can we add one?
4. INTERESTING CHOICE: Does it create meaningful decisions?

## Codebase Patterns

### ability.txt Format
```
N:<id>:<name>
I:<skill>:<ability_slot>:<level_req>
P:<skill>/<slot>:<skill>/<slot>  # Prerequisites
D:<description line>
T:<tval>:<sval_min>:<sval_max>   # Item types that can have this ability
```

### Skill Numbers
- S_MEL = 0 (Melee)
- S_ARC = 1 (Archery)
- S_EVN = 2 (Evasion)
- S_STL = 3 (Stealth)
- S_PER = 4 (Perception)
- S_WIL = 5 (Will)
- S_SMT = 6 (Smithing)
- S_LOR = 7 (Lore, was Song)

### Ability ID Ranges
- Melee: N:0-13 (14 abilities)
- Archery: N:20-28 (9 abilities)
- Evasion: N:40-50 (11 abilities)
- Stealth: N:60-66 (7 abilities)
- Perception: N:80-89 (10 abilities)
- Will: N:100-110 (11 abilities)
- Smithing: N:120-127 (8 abilities) - DONE in Alpha 0.2.0
- Lore: N:140-153 (14 abilities)

### Key Files
- lib/edit/ability.txt - Ability definitions
- lib/edit/object.txt - Item definitions (tval/sval)
- lib/edit/artefact.txt - Artifact definitions
- lib/edit/special.txt - Ego item definitions
- lib/edit/race.txt - Race definitions
- src/cmd4.c - Smithing/ability command handling
- src/defines.h - Constant definitions
- src/externs.h - External declarations
- src/xtra1.c - Ability effect implementations
- src/xtra2.c - More ability effects

### TV (Type Value) Constants
- TV_SWORD = 23
- TV_POLEARM = 22
- TV_HAFTED = 21
- TV_BOW = 19
- TV_ARROW = 17
- TV_MAIL = 37
- TV_SOFT_ARMOR = 36
- TV_SHIELD = 34
- TV_HELM = 32
- TV_CLOAK = 35
- TV_GLOVES = 31
- TV_BOOTS = 30
- TV_RING = 45
- TV_AMULET = 40
- TV_LIGHT = 39

## Current Ability Summary

### Melee (14 abilities)
0. Power - +1 damage sides, harder crits
1. Finesse - Crit base 7->5
2. Knock Back - Push enemies
3. Polearm Mastery - +2 atk with polearms, set to receive
4. Charge - +3 str/dex after moving toward enemy
5. Follow-Through - Continue attack after kill
6. Impale - Attack through enemies (polearm/greatsword)
7. Subtlety - Better crits with one hand free
8. Whirlwind Attack - Free attacks on all adjacent enemies
9. Zone of Control - Free attack when enemy moves between adj squares
10. Smite - Max damage first attack with 2H, lose a turn
11. Two Weapon Fighting - Off-hand weapon attack
12. Rapid Attack - Extra attack at -3 str/dex
13. Strength - +1 Str

### Archery (9 abilities)
0. Rout - +5 dex vs fleeing
1. Fletchery - Craft +3 arrows
2. Point Blank Archery - No opportunity attacks when firing
3. Puncture - 5 flat damage if blocked
4. Ambush - +1 crit die vs unwary/sleeping (STEALTH SYNERGY)
5. Versatility - Archery bonus applies to melee
6. Crippling Shot - Crits slow enemies
7. Deadly Hail - 2x damage turn after kill
8. Dexterity - +1 Dex

### Evasion (11 abilities)
0. Dodging - +3 evn if moved last turn
1. Blocking - 2x shield protection if didn't move
2. Parry - 2x weapon evasion bonus
3. Crowd Fighting - Halves surround bonus
4. Leaping - Jump over chasms/traps
5. Sprinting - Speed boost after 4+ squares
6. Flanking - Free attack when stepping around enemy
7. Heavy Armour Use - Protection from armor weight
8. Riposte - Free attack on big miss
9. Controlled Retreat - Free attack when stepping away
10. Dexterity - +1 Dex

### Stealth (7 abilities) - CORE TREE
0. Disguise - Halves LoS detection bonus
1. Assassination - +Stealth to melee vs non-alert
2. Cruel Blow - Crits confuse (PREREQ: Assassination)
3. Exchange Places - Swap with enemy
4. Opportunist - Free attack when adj enemy moves away
5. Vanish - +10 stealth to make enemies unwary
6. Dexterity - +1 Dex

### Perception (10 abilities)
0. Quick Study - Take abilities without prereqs
1. Focused Attack - +Per/2 if passed last turn
2. Keen Senses - See beyond light edge, +5 vs invisible
3. Concentration - +1 atk per round vs same enemy
4. Alchemy - Identify herbs/potions/staves/horns
5. Bane - Bonus vs selected enemy type
6. Outwit - Negate crits with Per roll
7. Listen - Detect unseen enemies
8. Master Hunter - +1 atk per kill of same type
9. Grace - +1 Gra

### Will (11 abilities)
0. Curse Breaking - Remove curses
1. Channeling - 2x efficient with staves/horns
2. Strength in Adversity - Bonuses when injured
3. Formidable - Kills scare enemies
4. Inner Light - +2 light intensity
5. Indomitable - Resist fear/confuse/stun/hallucinate
6. Oath - Swear oath for rewards
7. Poison Resistance - Resist poison
8. Vengeance - Extra die after being damaged
9. Majesty - Lower enemy morale by Will diff
10. Constitution - +1 Con

### Smithing (8 abilities) - COMPLETE
0. Weaponsmith - Create weapons
1. Armoursmith - Create armour
2. Jeweller - Create rings/amulets/etc
3. Reforge - Combine Broken Glowing -> enchanted
4. Expertise - Halve forge time, no stat costs
5. Reclaim - Combine Broken Strange -> random artifact
6. Masterwork - Combine 4 Broken Strange -> best artifact
7. Grace - +1 Gra

### Lore (14 abilities) - Already Third Age themed
0. Word of Command - Fear nearby enemies
1. Lore of Battle - Provoke enemies to melee
2. Deep Memory - Sense nearby passages
3. Word of Opening - Unlock doors/traps
4. Lore of Silence - Dampen sounds (STEALTH SYNERGY)
5. Herbcraft - Double herb effectiveness
6. Word of Shutting - Seal doors
7. Inner Light - +light per Lore
8. Deadly Lore - Instant kill on low HP crits
9. Lore of Endurance - +Will, +protection
10. Lore of Sleep - Put enemies to sleep
11. Word of Mastery - Paralyze enemies
12. Device Mastery - Two lore effects at once
13. Grace - +1 Gra

## Progress Log

### 2026-01-09 - PREP-001 Complete
- Created progress.txt with codebase patterns
- Documented all 8 skill trees and their current abilities
- Identified stealth synergies: Ambush (Archery), Lore of Silence (Lore)
- Note: Smithing tree complete from Alpha 0.2.0

### Next Steps
1. MEL-001: Research Melee precedents in Third Age
2. Continue through all skill trees per PRD
